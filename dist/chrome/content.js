(()=>{"use strict";const e="undefined"!=typeof browser?browser:chrome,t={port:null,selectedText:"",pageText:""};function n(){const e=window.getSelection().toString().trim();let n="";return e?(t.selectedText=e,n=e):(n=Array.from(document.body.getElementsByTagName("*")).filter((e=>{const t=window.getComputedStyle(e);return"none"!==t.display&&"hidden"!==t.visibility&&!e.hidden})).map((e=>Array.from(e.childNodes).filter((e=>e.nodeType===Node.TEXT_NODE)).map((e=>e.textContent.trim())).join(" "))).filter((e=>e.length>0)).join("\n").replace(/[\s\n]+/g," ").trim(),t.pageText=n),n.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<[^>]+>/g,"").replace(/[^\w\s.,!?-]/g," ").trim()}e.runtime.onMessage.addListener(((r,o,i)=>{if("getContent"===r.action)return function(){if(!t.port||t.port.disconnected)try{t.port=e.runtime.connect({name:"content-script"}),t.port.onDisconnect.addListener((()=>{t.port.disconnected=!0}))}catch(e){console.error("Connection error:",e)}}(),i({content:n()}),!0}))})();